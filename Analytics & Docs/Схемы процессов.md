# Блок-схемы процессов
## Приложение для разработки маршрутов "Майской прогулки"

### 1. Процесс создания нового маршрута

```mermaid
graph TD
    A[Начало] --> B[Создать новый маршрут]
    B --> C[Ввод названия и описания]
    C --> D[Выбор года мероприятия]
    D --> E[Инициализация карты]
    E --> F[Режим рисования маршрута]
    
    F --> G{Добавить точку?}
    G -- Да --> H[Клик на карту для добавления точки]
    H --> I[Определить тип точки]
    I --> J[Обычная точка]
    I --> K[Узловая точка]
    J --> L[Добавить точку в маршрут]
    K --> M[Создать узловую точку]
    M --> N[Обновить связанные маршруты]
    N --> O[Сохранить изменения]
    L --> O
    O --> P{Продолжить рисование?}
    P -- Да --> F
    P -- Нет --> Q[Расчет метрик маршрута]
    
    Q --> R[Расчет общего километража]
    R --> S[Анализ типов покрытия]
    S --> T[Расчет времени прохождения]
    T --> U[Отображение статистики]
    U --> V[Сохранение маршрута]
    V --> W[Конец]
```

### 2. Процесс редактирования существующего маршрута

```mermaid
graph TD
    A[Начало] --> B[Выбор маршрута из списка]
    B --> C[Загрузка данных маршрута]
    C --> D[Отображение маршрута на карте]
    D --> E[Режим редактирования]
    
    E --> F{Выбор действия}
    F --> G[Переместить точку]
    F --> H[Добавить точку]
    F --> I[Удалить точку]
    F --> J[Изменить атрибуты]
    
    G --> K[Перетаскивание точки]
    K --> L{Точка узловая?}
    L -- Да --> M[Обновить все связанные маршруты]
    L -- Нет --> N[Обновить только текущий маршрут]
    M --> O[Сохранить изменения]
    N --> O
    
    H --> P[Клик на карту для новой точки]
    P --> Q[Определить тип и параметры точки]
    Q --> O
    
    I --> R[Выбор точки для удаления]
    R --> S{Точка узловая?}
    S -- Да --> T[Предупреждение о влиянии на другие маршруты]
    T --> U[Подтверждение удаления]
    U --> V[Удалить точку и обновить связи]
    S -- Нет --> V
    V --> O
    
    J --> W[Открыть панель свойств]
    W --> X[Изменение параметров]
    X --> O
    
    O --> Y{Продолжить редактирование?}
    Y -- Да --> E
    Y -- Нет --> Z[Финальное сохранение]
    Z --> AA[Конец]
```

### 3. Процесс автоматического притягивания к тропам

```mermaid
graph TD
    A[Начало рисования/редактирования] --> B[Получение координат точки]
    B --> C[Поиск ближайших троп в радиусе R]
    C --> D{Найдены тропы?}
    D -- Нет --> E[Оставить точку без изменений]
    D -- Да --> F[Показать доступные тропы]
    
    F --> G{Пользователь выбрал притягивание?}
    G -- Нет --> E
    G -- Да --> H[Определить ближайшую точку на тропе]
    H --> I[Переместить точку к тропе]
    I --> J[Обновить координаты точки]
    J --> K[Отобразить результат пользователю]
    K --> L[Сохранить изменения]
    
    E --> M[Продолжить работу]
    L --> M
```

### 4. Процесс анализа маршрута

```mermaid
graph TD
    A[Начало анализа] --> B[Загрузка данных маршрута]
    B --> C[Получение всех точек маршрута]
    C --> D[Разбиение на сегменты]
    
    D --> E[Для каждого сегмента]
    E --> F[Запрос к OpenStreetMaps]
    F --> G[Определение типа покрытия]
    G --> H[Расчет длины сегмента]
    H --> I[Добавление в статистику]
    
    I --> J{Все сегменты обработаны?}
    J -- Нет --> E
    J -- Да --> K[Агрегация статистики]
    
    K --> L[Расчет общего расстояния]
    L --> M[Расчет времени прохождения]
    M --> N[Формирование отчета]
    N --> O[Отображение результатов]
    O --> P[Конец]
```

### 5. Процесс импорта/экспорта данных

```mermaid
graph TD
    A[Начало] --> B{Действие: Импорт или Экспорт?}
    
    B --> C[Импорт]
    B --> D[Экспорт]
    
    C --> E[Выбор файла GPX/KML/KMZ]
    E --> F[Загрузка файла]
    F --> G[Парсинг файла]
    G --> H[Валидация данных]
    H --> I{Ошибки валидации?}
    I -- Да --> J[Показать ошибки]
    J --> K[Исправить файл]
    K --> E
    I -- Нет --> L[Создание маршрута в БД]
    L --> M[Отображение на карте]
    M --> N[Конец]
    
    D --> O[Выбор маршрута для экспорта]
    O --> P[Выбор формата]
    P --> Q[Генерация файла]
    Q --> R[Сохранение файла]
    R --> S[Скачивание пользователем]
    S --> N
```

### 6. Процесс совместной работы

```mermaid
graph TD
    A[Пользователь 1 начинает редактирование] --> B[Блокировка маршрута]
    B --> C[Редактирование маршрута]
    C --> D[Автосохранение изменений]
    
    E[Пользователь 2 пытается редактировать] --> F{Маршрут заблокирован?}
    F -- Да --> G[Показать сообщение о блокировке]
    G --> H[Режим только для просмотра]
    F -- Нет --> I[Разрешить редактирование]
    
    C --> J[Сохранение изменений]
    J --> K[Разблокировка маршрута]
    K --> L[Уведомление других пользователей]
    
    D --> M{Продолжить редактирование?}
    M -- Да --> C
    M -- Нет --> J
```

### 7. Процесс работы с узловыми точками

```mermaid
graph TD
    A[Создание/изменение узловой точки] --> B[Проверка на узловую точку]
    B --> C[Получение списка связанных маршрутов]
    C --> D{Есть связанные маршруты?}
    
    D -- Нет --> E[Обычное сохранение точки]
    D -- Да --> F[Показать предупреждение]
    
    F --> G[Пользователь подтверждает изменения]
    G --> H[Обновление координат узловой точки]
    H --> I[Для каждого связанного маршрута]
    
    I --> J[Пересчет геометрии маршрута]
    J --> K[Обновление статистики маршрута]
    K --> L[Сохранение изменений]
    
    L --> M[Уведомление пользователей]
    M --> N[Обновление отображения на карте]
    
    E --> N
    N --> O[Конец]
```

### 8. Процесс притягивания к маршрутам прошлых лет

```mermaid
graph TD
    A[Начало рисования нового участка] --> B[Анализ близости к существующим маршрутам]
    B --> C[Поиск маршрутов прошлых лет в радиусе]
    C --> D{Найдены похожие участки?}
    
    D -- Нет --> E[Продолжить обычное рисование]
    D -- Да --> F[Показать найденные участки]
    
    F --> G{Пользователь хочет притягивание?}
    G -- Нет --> E
    G -- Да --> H[Выбор опорного маршрута]
    
    H --> I[Корректировка нового участка]
    I --> J[Привязка к выбранному маршруту]
    J --> K[Обновление геометрии]
    K --> L[Сохранение корректировки]
    
    E --> M[Конец процесса]
    L --> M
```

### 9. Процесс генерации отчетов

```mermaid
graph TD
    A[Запрос на генерацию отчета] --> B[Выбор маршрута/маршрутов]
    B --> C[Выбор типа отчета]
    C --> D{Тип отчета}
    
    D --> E[Краткий отчет]
    D --> F[Детальный отчет]
    D --> G[Сравнительный отчет]
    
    E --> H[Сбор базовой информации]
    H --> I[Расчет основных метрик]
    
    F --> J[Сбор детальной информации]
    J --> K[Анализ всех сегментов]
    K --> L[Расчет времени прохождения]
    
    G --> M[Загрузка нескольких маршрутов]
    M --> N[Сравнение метрик]
    N --> O[Выделение отличий]
    
    I --> P[Формирование PDF/HTML]
    L --> P
    O --> P
    
    P --> Q[Сохранение отчета]
    Q --> R[Отправка пользователю]
    R --> S[Конец]
```