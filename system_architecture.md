# Архитектура системы
## Приложение для разработки маршрутов "Майской прогулки"

### 1. Общая архитектура

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           Клиентская часть                              │
├─────────────────────────────────────────────────────────────────────────┤
│  Web-интерфейс (HTML5/CSS3/JavaScript)                                 │
│  ├── Модуль работы с картами (Leaflet/OpenLayers)                     │
│  ├── Модуль редактирования маршрутов                                   │
│  ├── Модуль анализа и расчетов                                         │
│  └── Модуль импорта/экспорта данных                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                           API Gateway                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                          Серверная часть                                │
├─────────────────────────────────────────────────────────────────────────┤
│  Backend сервисы                                                        │
│  ├── Сервис маршрутов (Route Service)                                  │
│  ├── Сервис карт (Map Service)                                        │
│  ├── Сервис анализа (Analysis Service)                                 │
│  ├── Сервис хранения (Storage Service)                                 │
│  └── Сервис пользователей (User Service)                               │
├─────────────────────────────────────────────────────────────────────────┤
│                        База данных                                    │
├─────────────────────────────────────────────────────────────────────────┤
│  PostgreSQL + PostGIS                                                  │
│  ├── Таблица маршрутов                                                 │
│  ├── Таблица точек                                                     │
│  ├── Таблица узловых точек                                             │
│  └── Таблица пользователей                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                    Внешние сервисы                                    │
├─────────────────────────────────────────────────────────────────────────┤
│  • OpenStreetMaps API                                                  │
│  • Google Maps API                                                     │
│  • Yandex Maps API                                                     │
│  • Облачное хранилище (Google Drive/Yandex Disk)                       │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2. Компонентная архитектура

#### 2.1 Клиентская часть

**Карта (Map Module)**
- Интеграция с картографическими сервисами
- Отображение маршрутов и точек
- Обработка пользовательских событий
- Масштабирование и навигация

**Редактор маршрутов (Route Editor)**
- Создание и редактирование точек
- Рисование линий маршрутов
- Работа с узловыми точками
- Перетаскивание элементов

**Анализатор (Analysis Module)**
- Расчет расстояний
- Определение типов покрытия
- Время прохождения маршрутов
- Статистика маршрутов

**Менеджер данных (Data Manager)**
- Импорт/экспорт GPX/KML/KMZ
- Сохранение в облачное хранилище
- Синхронизация данных
- Работа с историей маршрутов

#### 2.2 Серверная часть

**Сервис маршрутов**
- CRUD операции для маршрутов
- Управление точками маршрутов
- Работа с узловыми точками
- Валидация данных

**Сервис анализа**
- Расчет метрик маршрутов
- Анализ покрытия дорог
- Оптимизация треков
- Генерация отчетов

**Сервис хранения**
- Интеграция с облачными хранилищами
- Управление файлами
- Версионирование данных
- Резервное копирование

### 3. Модель данных

#### 3.1 Основные сущности

**Маршрут (Route)**
- id: UUID
- name: String
- description: Text
- year: Integer
- status: Enum (draft/final/archived)
- created_by: User
- created_at: Timestamp

**Точка маршрута (RoutePoint)**
- id: UUID
- route_id: UUID
- latitude: Decimal
- longitude: Decimal
- order_index: Integer
- point_type: Enum (regular/node)
- elevation: Decimal (опционально)

**Узловая точка (NodePoint)**
- id: UUID
- latitude: Decimal
- longitude: Decimal
- connected_routes: Array<UUID>
- metadata: JSON

**Пользователь (User)**
- id: UUID
- email: String
- name: String
- role: Enum (admin/editor/viewer)

### 4. Потоки данных

```
Пользователь → Web-интерфейс → API → Сервисы → База данных
     ↓              ↓         ↓        ↓            ↓
Карта/Редактор → Валидация → Обработка → Хранение ← Ответ
```

### 5. Технологический стек

**Frontend:**
- HTML5/CSS3 (Tailwind CSS)
- JavaScript (ES6+)
- Leaflet.js для карт
- Axios для HTTP запросов
- LocalStorage для кэширования

**Backend:**
- Node.js с Express или Python с FastAPI
- PostgreSQL с PostGIS для геоданных
- Redis для кэширования
- JWT для аутентификации

**Инфраструктура:**
- Docker для контейнеризации
- Nginx для reverse proxy
- SSL сертификаты для безопасности
- Мониторинг и логирование

### 6. Масштабируемость

- Горизонтальное масштабирование серверов
- Кэширование статических данных
- CDN для карт и ресурсов
- Оптимизация запросов к базе данных